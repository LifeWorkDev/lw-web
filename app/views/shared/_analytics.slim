- if (google_analytics_key = Rails.application.credentials.google_analytics)
  script async=true src='https://cdnjs.cloudflare.com/ajax/libs/autotrack/2.4.1/autotrack.js'
  javascript:
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    if (typeof ga !== 'undefined') {
      ga('create', '#{google_analytics_key}', 'auto');
      ga('require', 'ec');
      ga('require', 'cleanUrlTracker', { trailingSlash: 'remove' });
      ga('require', 'maxScrollTracker', { maxScrollMetricIndex: 1 });
      ga('require', 'impressionTracker', { elements: ['download_card', 'view_benefits', 'social_share'] });
      ga('require', 'outboundFormTracker');
      ga('require', 'outboundLinkTracker');
      ga('require', 'pageVisibilityTracker', { sendInitialPageview: true, visibleMetricIndex: 2 });
      ga('require', 'socialWidgetTracker');
      ga('require', 'urlChangeTracker');
    }

- intercom = Rails.application.credentials.intercom
- if user_signed_in?
  ruby:
    user_id = current_user.id
    email = current_user.email
    name = current_user.name
    intercom_hash = OpenSSL::HMAC.hexdigest('sha256', intercom[:secret], user_id.to_s) if intercom
  javascript:
    window.intercomSettings = {
      name: '#{name}',
      email: '#{email}',
      user_id: #{user_id},
      user_hash: '#{intercom_hash}',
      created_at: #{current_user.created_at.to_i},
    }
    if (window.bugsnagClient) {
      window.bugsnagClient.user = {
        id: #{user_id},
        name: '#{name}',
        email: '#{email}'
      }
    }
  - if (org = current_user.org)
    javascript:
      window.intercomSettings.company = {
        id: #{org.id},
        created_at: #{org.created_at.to_i},
        name: '#{org.name}',
      }

- if intercom
  javascript:
    window.intercomSettings || (window.intercomSettings = {})
    window.intercomSettings.app_id = '#{intercom[:id]}';
    (function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',w.intercomSettings);}else{var d=document;var i=function(){i.c(arguments);};i.q=[];i.c=function(args){i.q.push(args);};w.Intercom=i;var l=function(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/e0o4isl3';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);};if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()
